(function(n){var i=n.browser.msie&&parseInt(n.browser.version)===6&&typeof window.XMLHttpRequest!="object",u=n.browser.msie&&parseInt(n.browser.version)===7,r=null,t=[];n.modal=function(t,i){return n.modal.impl.init(t,i)},n.modal.close=function(){n.modal.impl.close()},n.modal.focus=function(t){n.modal.impl.focus(t)},n.modal.setContainerDimensions=function(){n.modal.impl.setContainerDimensions()},n.modal.setPosition=function(){n.modal.impl.setPosition()},n.modal.update=function(t,i){n.modal.impl.update(t,i)},n.fn.modal=function(t){return n.modal.impl.init(this,t)},n.modal.defaults={appendTo:"body",focus:!0,opacity:50,overlayId:"simplemodal-overlay",overlayCss:{},containerId:"simplemodal-container",containerCss:{},dataId:"simplemodal-data",dataCss:{},minHeight:null,minWidth:null,maxHeight:null,maxWidth:null,autoResize:!1,autoPosition:!0,zIndex:1e3,close:!0,closeHTML:'<a class="modalCloseImg" title="Close"><\/a>',closeClass:"simplemodal-close",escClose:!0,overlayClose:!1,position:null,persist:!1,modal:!0,onOpen:null,onShow:null,onClose:null},n.modal.impl={d:{},init:function(t,i){var u=this;if(u.d.data)return!1;if(r=n.browser.msie&&!n.boxModel,u.o=n.extend({},n.modal.defaults,i),u.zIndex=u.o.zIndex,u.occb=!1,typeof t=="object")t=t instanceof jQuery?t:n(t),u.d.placeholder=!1,t.parent().parent().size()>0&&(t.before(n("<span><\/span>").attr("id","simplemodal-placeholder").css({display:"none"})),u.d.placeholder=!0,u.display=t.css("display"),u.o.persist||(u.d.orig=t.clone(!0)));else if(typeof t=="string"||typeof t=="number")t=n("<div><\/div>").html(t);else return alert("SimpleModal Error: Unsupported data type: "+typeof t),u;return u.create(t),t=null,u.open(),n.isFunction(u.o.onShow)&&u.o.onShow.apply(u,[u.d]),u},create:function(u){var f=this;t=f.getDimensions(),f.o.modal&&i&&(f.d.iframe=n('<iframe src="javascript:false;"><\/iframe>').css(n.extend(f.o.iframeCss,{display:"none",opacity:0,position:"fixed",height:t[0],width:t[1],zIndex:f.o.zIndex,top:0,left:0})).appendTo(f.o.appendTo)),f.d.overlay=n("<div><\/div>").attr("id",f.o.overlayId).addClass("simplemodal-overlay").css(n.extend(f.o.overlayCss,{display:"none",opacity:f.o.opacity/100,height:f.o.modal?t[0]:0,width:f.o.modal?t[1]:0,position:"fixed",left:0,top:0,zIndex:f.o.zIndex+1})).appendTo(f.o.appendTo),f.d.container=n("<div><\/div>").attr("id",f.o.containerId).addClass("simplemodal-container").css(n.extend(f.o.containerCss,{display:"none",position:"fixed",zIndex:f.o.zIndex+2})).append(f.o.close&&f.o.closeHTML?n(f.o.closeHTML).addClass(f.o.closeClass):"").appendTo(f.o.appendTo),f.d.wrap=n("<div><\/div>").attr("tabIndex",-1).addClass("simplemodal-wrap").css({height:"100%",outline:0,width:"100%"}).appendTo(f.d.container),f.d.data=u.attr("id",u.attr("id")||f.o.dataId).addClass("simplemodal-data").css(n.extend(f.o.dataCss,{display:"none"})).appendTo("body"),u=null,f.setContainerDimensions(),f.d.data.appendTo(f.d.wrap),(i||r)&&f.fixIE()},bindEvents:function(){var u=this;n("."+u.o.closeClass).bind("click.simplemodal",function(n){n.preventDefault(),u.close()}),u.o.modal&&u.o.close&&u.o.overlayClose&&u.d.overlay.bind("click.simplemodal",function(n){n.preventDefault(),u.close()}),n(document).bind("keydown.simplemodal",function(n){u.o.modal&&n.keyCode===9?u.watchTab(n):u.o.close&&u.o.escClose&&n.keyCode===27&&(n.preventDefault(),u.close())}),n(window).bind("resize.simplemodal",function(){t=u.getDimensions(),u.o.autoResize?u.setContainerDimensions():u.o.autoPosition&&u.setPosition(),i||r?u.fixIE():u.o.modal&&(u.d.iframe&&u.d.iframe.css({height:t[0],width:t[1]}),u.d.overlay.css({height:t[0],width:t[1]}))})},unbindEvents:function(){n("."+this.o.closeClass).unbind("click.simplemodal"),n(document).unbind("keydown.simplemodal"),n(window).unbind("resize.simplemodal"),this.d.overlay.unbind("click.simplemodal")},fixIE:function(){var i=this,t=i.o.position;n.each([i.d.iframe||null,i.o.modal?i.d.overlay:null,i.d.container],function(n,i){var a,v,s,h;if(i){var e="document.body.clientHeight",o="document.body.clientWidth",y="document.body.scrollHeight",c="document.body.scrollLeft",l="document.body.scrollTop",p="document.body.scrollWidth",w="document.documentElement.clientHeight",b="document.documentElement.clientWidth",u="document.documentElement.scrollLeft",f="document.documentElement.scrollTop",r=i[0].style;r.position="absolute",n<2?(r.removeExpression("height"),r.removeExpression("width"),r.setExpression("height",""+y+" > "+e+" ? "+y+" : "+e+' + "px"'),r.setExpression("width",""+p+" > "+o+" ? "+p+" : "+o+' + "px"')):(t&&t.constructor===Array?(s=t[0]?typeof t[0]=="number"?t[0].toString():t[0].replace(/px/,""):i.css("top").replace(/px/,""),a=s.indexOf("%")===-1?s+" + (t = "+f+" ? "+f+" : "+l+') + "px"':parseInt(s.replace(/%/,""))+" * (("+w+" || "+e+") / 100) + (t = "+f+" ? "+f+" : "+l+') + "px"',t[1]&&(h=typeof t[1]=="number"?t[1].toString():t[1].replace(/px/,""),v=h.indexOf("%")===-1?h+" + (t = "+u+" ? "+u+" : "+c+') + "px"':parseInt(h.replace(/%/,""))+" * (("+b+" || "+o+") / 100) + (t = "+u+" ? "+u+" : "+c+') + "px"')):(a="("+w+" || "+e+") / 2 - (this.offsetHeight / 2) + (t = "+f+" ? "+f+" : "+l+') + "px"',v="("+b+" || "+o+") / 2 - (this.offsetWidth / 2) + (t = "+u+" ? "+u+" : "+c+') + "px"'),r.removeExpression("top"),r.removeExpression("left"),r.setExpression("top",a),r.setExpression("left",v))}})},focus:function(t){var i=this,u=t&&n.inArray(t,["first","last"])!==-1?t:"first",r=n(":input:enabled:visible:"+u,i.d.wrap);setTimeout(function(){r.length>0?r.focus():i.d.wrap.focus()},10)},getDimensions:function(){var t=n(window),i=n.browser.opera&&n.browser.version>"9.5"&&n.fn.jquery<"1.3"||n.browser.opera&&n.browser.version<"9.5"&&n.fn.jquery>"1.2.6"?t[0].innerHeight:t.height();return[i,t.width()]},getVal:function(n,i){return n?typeof n=="number"?n:n==="auto"?0:n.indexOf("%")>0?parseInt(n.replace(/%/,""))/100*(i==="h"?t[0]:t[1]):parseInt(n.replace(/px/,"")):null},update:function(n,t){var i=this;if(!i.d.data)return!1;i.d.origHeight=i.getVal(n,"h"),i.d.origWidth=i.getVal(t,"w"),i.d.data.hide(),n&&i.d.container.css("height",n),t&&i.d.container.css("width",t),i.setContainerDimensions(),i.d.data.show(),i.o.focus&&i.focus(),i.unbindEvents(),i.bindEvents()},setContainerDimensions:function(){var r=this,p=i||u,f=r.d.origHeight?r.d.origHeight:n.browser.opera?r.d.container.height():r.getVal(p?r.d.container[0].currentStyle.height:r.d.container.css("height"),"h"),e=r.d.origWidth?r.d.origWidth:n.browser.opera?r.d.container.width():r.getVal(p?r.d.container[0].currentStyle.width:r.d.container.css("width"),"w"),h=r.d.data.outerHeight(!0),c=r.d.data.outerWidth(!0),o;r.d.origHeight=r.d.origHeight||f,r.d.origWidth=r.d.origWidth||e;var v=r.o.maxHeight?r.getVal(r.o.maxHeight,"h"):null,y=r.o.maxWidth?r.getVal(r.o.maxWidth,"w"):null,l=v&&v<t[0]?v:t[0],a=y&&y<t[1]?y:t[1],s=r.o.minHeight?r.getVal(r.o.minHeight,"h"):"auto";f=f?r.o.autoResize&&f>l?l:f<s?s:f:h?h>l?l:r.o.minHeight&&s!=="auto"&&h<s?s:h:s,o=r.o.minWidth?r.getVal(r.o.minWidth,"w"):"auto",e=e?r.o.autoResize&&e>a?a:e<o?o:e:c?c>a?a:r.o.minWidth&&o!=="auto"&&c<o?o:c:o,r.d.container.css({height:f,width:e}),r.d.wrap.css({overflow:h>f||c>e?"auto":"visible"}),r.o.autoPosition&&r.setPosition()},setPosition:function(){var n=this,i,r,u=t[0]/2-n.d.container.outerHeight(!0)/2,f=t[1]/2-n.d.container.outerWidth(!0)/2;n.o.position&&Object.prototype.toString.call(n.o.position)==="[object Array]"?(i=n.o.position[0]||u,r=n.o.position[1]||f):(i=u,r=f),n.d.container.css({left:r,top:i})},watchTab:function(t){var i=this,r;n(t.target).parents(".simplemodal-container").length>0?(i.inputs=n(":input:enabled:visible:first, :input:enabled:visible:last",i.d.data[0]),(!t.shiftKey&&t.target===i.inputs[i.inputs.length-1]||t.shiftKey&&t.target===i.inputs[0]||i.inputs.length===0)&&(t.preventDefault(),r=t.shiftKey?"last":"first",i.focus(r))):(t.preventDefault(),i.focus())},open:function(){var t=this;t.d.iframe&&t.d.iframe.show(),n.isFunction(t.o.onOpen)?t.o.onOpen.apply(t,[t.d]):(t.d.overlay.show(),t.d.container.show(),t.d.data.show()),t.o.focus&&t.focus(),t.bindEvents()},close:function(){var t=this,i;if(!t.d.data)return!1;t.unbindEvents(),n.isFunction(t.o.onClose)&&!t.occb?(t.occb=!0,t.o.onClose.apply(t,[t.d])):(t.d.placeholder?(i=n("#simplemodal-placeholder"),t.o.persist?i.replaceWith(t.d.data.removeClass("simplemodal-data").css("display",t.display)):(t.d.data.hide().remove(),i.replaceWith(t.d.orig))):t.d.data.hide().remove(),t.d.container.hide().remove(),t.d.overlay.hide(),t.d.iframe&&t.d.iframe.hide().remove(),setTimeout(function(){t.d.overlay.remove(),t.d={}},10))}}})(jQuery)